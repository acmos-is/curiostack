---
steps:
- id: refresh-build-image
  name: gcr.io/cloud-builders/docker
  args:
  - build
  - --tag=asia.gcr.io/curioswitch-cluster/java-cloud-builder:latest
  - --file=./tools/build-images/java-cloud-builder/Dockerfile
  - .
- id: build-curio-auth-server-dist
  waitFor: refresh-build-image
  name: asia.gcr.io/curioswitch-cluster/java-cloud-builder:latest
  entrypoint: ./gradlew
  args:
  - :auth:server:dockerDistTar
- id: build-curio-auth-server-image
  waitFor: build-curio-auth-server-dist
  name: gcr.io/cloud-builders/docker
  args:
  - build
  - --tag=asia.gcr.io/$PROJECT_ID/curio-auth-server:latest
  - auth/server/build/docker
images:
- asia.gcr.io/$PROJECT_ID/curio-auth-server:latest
